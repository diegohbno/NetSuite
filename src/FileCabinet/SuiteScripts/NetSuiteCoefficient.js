/* eslint no-use-before-define: 0 */
/* eslint-disable */
/**
 * @preserve
 * @NApiVersion 2.1
 * @NScriptType Restlet
 * @NModuleScope Public
 */
/*
@license
Copyright 2024 Coefficient Works, Inc

Permission is hereby granted to any person obtaining a copy of this software and associated
documentation files (the "Software"), to use the Software exclusively in conjunction with
Coefficient's cloud-based data syncing and automation technology services (the "Services"),
subject to the following conditions:

1. The above copyright notice and this permission notice shall be included in all
   copies or substantial portions of the Software.

2. The Software may only be used in connection with the Services and may not be redistributed or
   used in other projects or products without prior written permission from Coefficient Works, Inc.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR
ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
IN THE SOFTWARE.
*/
var log,search,dataset,workbook,record,runtime,query,response=new Object;function main(e,t,r,a,o,n,u){return log=e,search=t,dataset=r,workbook=a,record=o,runtime=n,query=u,{post:postProcess}}function addColumnNamesToValues(e,a){return e.reduce((e,t,r)=>(e[t]=a[r],e),{})}function getDataFromPaginatedResults(t,e,r,a,o){let n=[];var u=Math.floor((r+1)/e),s=Math.min(Math.floor((r+a-1)/e),t.pageRanges.length-1);for(let e=u;e<=s;e++){var l=t.fetch(e);let r=l.data;if("dataset"===o){let t=r.columns.map(e=>e.alias),e=l.data.results;r=e.map(e=>addColumnNamesToValues(t,e.values))}n=n.concat(r)}return n}function getSavedSearchPaginatedResults(e,t,r,a){let o=[],n=r;for(;n<a;){var u=e.getRange({start:n,end:n+t});o=o.concat(u),n+=t}return o}function getSavedSearchAllResults(e){let t=[],r=0;for(;r<5e5;){var a=e.getRange({start:r,end:r+1e3});if(t=t.concat(a),!a.length)break;r+=1e3}return t}function getSearchFilters(e){let t={ON:search.Operator.ON,AFTER:search.Operator.AFTER,BEFORE:search.Operator.BEFORE,ONORAFTER:search.Operator.ONORAFTER,ONORBEFORE:search.Operator.ONORBEFORE,WITHIN:search.Operator.WITHIN,BETWEEN:search.Operator.BETWEEN,EQUALTO:search.Operator.EQUALTO,NOTEQUALTO:search.Operator.NOTEQUALTO,GREATERTHAN:search.Operator.GREATERTHAN,GREATERTHANOREQUALTO:search.Operator.GREATERTHANOREQUALTO,LESSTHAN:search.Operator.LESSTHAN,LESSTHANOREQUALTO:search.Operator.LESSTHANOREQUALTO,CONTAINS:search.Operator.CONTAINS,DOESNOTCONTAIN:search.Operator.DOESNOTCONTAIN,IS:search.Operator.IS,ISNOT:search.Operator.ISNOT,ANYOF:search.Operator.ANYOF,NONEOF:search.Operator.NONEOF,ISEMPTY:search.Operator.ISEMPTY,ISNOTEMPTY:search.Operator.ISNOTEMPTY},r=[];return e&&0<e.length&&e.forEach(e=>{e=search.createFilter({name:e.name,join:e.join,operator:t[e.operator],values:e.values});r.push(e)}),r}function debugPrintSavedSearchObject(e,t,r,a,o){log.debug(`[${e}]Request`,t),log.debug(`[${e}]isMulti`,t.useMultibookAccounting),log.debug(`[${e}]Object Type`,r),log.debug(`[${e}]Filter Array`,a),log.debug(`[${e}]Search Columns`,o.map((e,t)=>t+1+". "+(e.join?e.join+"."+e.name:e.name)+(e.formula?" | Formula: "+e.formula:"")).join("\n"))}function getSearchColumnForReports(e,t){var r=t.useMultibookAccounting;let a=t.attrs_in_accounting_transaction;return!r||a.includes(e.name)||e.join?e:e.formula?((r=(t=e.formula.replace(/{([a-zA-Z_]+)}/g,(e,t)=>a.includes(t)?e:`{transaction.${t}}`))!==e.formula)&&(log.debug("originalFormula",e.formula),log.debug("updatedFormula",t)),{...e,...r&&{join:"transaction"},formula:t}):{...e,join:"transaction"}}function getAttributeFullNameForReportFilter(e,t){var r=t.useMultibookAccounting,t=t.attrs_in_accounting_transaction;return!r||e.includes(".")||t.includes(e)?e:"transaction."+e}function TrialBalanceReportPart1(e){var t=e.offset,r=e.limit,a=e.toDate,o=e.fromDate,n=e.subsidiary,u=e.accBook,s=e.useMultibookAccounting,l=[["posting","is","T"],"AND",["formulatext: {account}","isnotempty",""],"AND",["accounttype","anyof","Income","COGS","Expense","OthIncome","OthExpense"],"AND",["sum(formulanumeric: CASE WHEN (SUM({creditamount}) - SUM({debitamount}) = 0) THEN 0 WHEN (SUM({debitamount}) IS null) AND (SUM({creditamount}) IS null) THEN 0 ELSE 1 END)","notequalto","0"]],o=(o&&a&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("trandate",e),"within",o,a])),n&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",n])),u&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",u])),s?"accountingtransaction":"transaction"),a=[search.createColumn(getSearchColumnForReports({name:"internalid",join:"account",summary:"GROUP",label:"Account Internal ID"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric2",summary:"SUM",formula:"SUM({amount})",label:"Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric3",summary:"SUM",formula:"SUM({fxamount})",label:"Foreign Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric4",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) < 0 THEN (SUM({debitamount})-SUM({creditamount})) WHEN (SUM({creditamount}) IS null) THEN (SUM({debitamount}))ELSE 0 END",label:"Debit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric5",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) > 0 THEN (SUM({creditamount})-SUM({debitamount})) WHEN (SUM({debitamount}) IS null) THEN (SUM({creditamount}))ELSE 0 END",label:"Credit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric6",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) < 0 THEN (SUM({debitfxamount})-SUM({creditfxamount})) WHEN (SUM({creditfxamount}) IS null) THEN (SUM({debitfxamount}))ELSE 0 END",label:"Debit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric7",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) > 0 THEN (SUM({creditfxamount})-SUM({debitfxamount})) WHEN (SUM({debitfxamount}) IS null) THEN (SUM({creditfxamount}))ELSE 0 END",label:"Credit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency",summary:"GROUP"},e)),search.createColumn(getSearchColumnForReports({name:"exchangerate",label:"Exchange Rate",summary:"GROUP"},e))],n=(debugPrintSavedSearchObject("TrialBalancePart1",e,o,l,a),search.create({type:o,settings:[],filters:l,columns:a})),u=n.runPaged({pageSize:1e3}).count;return{results:getSavedSearchPaginatedResults(n.run(),1e3,t,Math.min(t+r,u)),total_count:u}}function TrialBalanceReportPart2(e){var t=e.offset,r=e.limit,a=e.toDate,o=e.subsidiary,n=e.accBook,u=e.retainedAccId,s=e.useMultibookAccounting,l=[["posting","is","T"],"AND",["accounttype","noneof","Income","COGS","Expense","OthIncome","OthExpense"],"AND",["sum(formulanumeric: CASE WHEN (SUM({creditamount})-SUM({debitamount}) = 0) THEN 0 WHEN (SUM({debitamount}) IS null) AND (SUM({creditamount}) IS null) THEN 0 ELSE 1 END)","notequalto","0"]],a=(a&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("trandate",e),"onorbefore",a])),o&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",o])),n&&(l.push("AND"),l.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",n])),u&&(l.push("AND"),l.push(["account","noneof",u])),s?"accountingtransaction":"transaction"),o=[search.createColumn(getSearchColumnForReports({name:"internalid",join:"account",summary:"GROUP",label:"Account Internal ID"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric2",summary:"SUM",formula:"SUM({amount})",label:"Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric3",summary:"SUM",formula:"SUM({fxamount})",label:"Foreign Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric4",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) < 0 THEN (SUM({debitamount})-SUM({creditamount})) WHEN (SUM({creditamount}) IS null) THEN (SUM({debitamount}))ELSE 0 END",label:"Debit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric5",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) > 0 THEN (SUM({creditamount})-SUM({debitamount})) WHEN (SUM({debitamount}) IS null) THEN (SUM({creditamount}))ELSE 0 END",label:"Credit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric6",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) < 0 THEN (SUM({debitfxamount})-SUM({creditfxamount})) WHEN (SUM({creditfxamount}) IS null) THEN (SUM({debitfxamount}))ELSE 0 END",label:"Debit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric7",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) > 0 THEN (SUM({creditfxamount})-SUM({debitfxamount})) WHEN (SUM({debitfxamount}) IS null) THEN (SUM({creditfxamount}))ELSE 0 END",label:"Credit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency",summary:"GROUP"},e)),search.createColumn(getSearchColumnForReports({name:"exchangerate",label:"Exchange Rate",summary:"GROUP"},e))],n=(debugPrintSavedSearchObject("TrialBalancePart2",e,a,l,o),search.create({type:a,settings:[],filters:l,columns:o})),u=n.runPaged({pageSize:1e3}).count;return{results:getSavedSearchPaginatedResults(n.run(),1e3,t,Math.min(t+r,u)),total_count:u}}function getNetIncomeAmountOnDate(e,t,r,a){var o=a.useMultibookAccounting,n=[["accounttype","anyof","Income","OthIncome"],"AND",["posting","is","T"]],u=[["accounttype","anyof","COGS","Expense","OthExpense"],"AND",["posting","is","T"]],e=(e&&(n.push("AND"),n.push([getAttributeFullNameForReportFilter("trandate",a),"onorbefore",e]),u.push("AND"),u.push([getAttributeFullNameForReportFilter("trandate",a),"onorbefore",e])),t&&(n.push("AND"),n.push([getAttributeFullNameForReportFilter("subsidiary",a),"anyof",t]),u.push("AND"),u.push([getAttributeFullNameForReportFilter("subsidiary",a),"anyof",t])),r&&(n.push("AND"),n.push([getAttributeFullNameForReportFilter("accountingbook",a),"anyof",r]),u.push("AND"),u.push([getAttributeFullNameForReportFilter("accountingbook",a),"anyof",r])),[search.createColumn(getSearchColumnForReports({name:"currency",summary:"GROUP",label:"Currency"},a)),search.createColumn(getSearchColumnForReports({name:"amount",summary:"SUM",label:"Amount"},a)),search.createColumn(getSearchColumnForReports({name:"fxamount",summary:"SUM",label:"Foreign Amount"},a))]),t=o?"accountingtransaction":"transaction",r=(debugPrintSavedSearchObject("NetIncomeCalc-Income",a,t,n,e),debugPrintSavedSearchObject("NetIncomeCalc-Expense",a,t,u,e),search.create({type:t,settings:[],filters:n,columns:e})),o=search.create({type:t,settings:[],filters:u,columns:e});return{incomeResult:getSavedSearchAllResults(r.run()),expenseResult:getSavedSearchAllResults(o.run())}}function TrialBalanceReportPart3(e){var t=e.toDate,r=e.niDate,a=e.subsidiary,o=e.accBook,n=e.retainedAccId,u=e.useMultibookAccounting,s=[["posting","is","T"],"AND",["formulatext: {account}","isnotempty",""],"AND",["sum(formulanumeric: CASE WHEN (SUM({creditamount})-SUM({debitamount}) = 0) THEN 0 WHEN (SUM({debitamount}) IS null) AND (SUM({creditamount}) IS null) THEN 0 ELSE 1 END)","notequalto","0"]],t=(t&&(s.push("AND"),s.push([getAttributeFullNameForReportFilter("trandate",e),"onorbefore",t])),a&&(s.push("AND"),s.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",a])),o&&(s.push("AND"),s.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",o])),n&&(s.push("AND"),s.push([getAttributeFullNameForReportFilter("account",e),"anyof",n])),u?"accountingtransaction":"transaction"),n=[search.createColumn(getSearchColumnForReports({name:"formulanumeric2",summary:"SUM",formula:"SUM({amount})",label:"Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric3",summary:"SUM",formula:"SUM({fxamount})",label:"Foreign Amount Total"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency",summary:"GROUP"},e))];return debugPrintSavedSearchObject("TrialBalancePart3-RetainedEarning",e,t,s,n),{results:[{retainedEarning:getSavedSearchAllResults(search.create({type:t,settings:[],filters:s,columns:n}).run()),netIncome:getNetIncomeAmountOnDate(r,a,o,e)}],total_count:1}}function getPaginatedDataForTrialBalanceReport(e){var t=e.report_type;if("trial_balance_report"!==t)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:`Pagination is not supported for ${t} report`};log.debug("request",e);t=e.trial_balance_report_part;if("part1"===t)return TrialBalanceReportPart1(e);if("part2"===t)return TrialBalanceReportPart2(e);if("part3"===t)return TrialBalanceReportPart3(e);throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:"Invalid trial_balance_report_part specified"}}function getPaginatedAccountBalances(e){var t=e.report_type;if("account_balances"!==t)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:`Pagination is not supported for ${t} report`};var t=e.balancesDate,r=e.offset,a=e.accountingBook,o=e.subsidiary,n=e.accountingContext,u=[["posting","is","T"],"AND",["formulatext: {account}","isnotempty",""],"AND",["sum(formulanumeric: CASE WHEN (SUM({creditamount}) - SUM({debitamount}) = 0) THEN 0 WHEN (SUM({debitamount}) IS null) AND (SUM({creditamount}) IS null) THEN 0 ELSE 1 END)","notequalto","0"]],t=(t&&(u.push("AND"),u.push([getAttributeFullNameForReportFilter("trandate",e),"onorbefore",t])),o&&0<o.length&&(u.push("AND"),u.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",o])),a&&(u.push("AND"),u.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",a])),n&&(u.push("AND"),u.push([getAttributeFullNameForReportFilter("account.accountingcontext",e),"anyof",n])),[search.createColumn(getSearchColumnForReports({name:"internalid",join:"account",summary:"GROUP",label:"Account Internal ID"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric1",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) < 0 THEN (SUM({debitamount})-SUM({creditamount})) WHEN (SUM({creditamount}) IS null) THEN (SUM({debitamount}))ELSE 0 END",label:"Debit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric2",summary:"SUM",formula:"CASE WHEN (SUM({creditamount})-SUM({debitamount})) > 0 THEN (SUM({creditamount})-SUM({debitamount})) WHEN (SUM({debitamount}) IS null) THEN (SUM({creditamount}))ELSE 0 END",label:"Credit"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric3",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) < 0 THEN (SUM({debitfxamount})-SUM({creditfxamount})) WHEN (SUM({creditfxamount}) IS null) THEN (SUM({debitfxamount}))ELSE 0 END",label:"Debit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"formulanumeric4",summary:"SUM",formula:"CASE WHEN (SUM({creditfxamount})-SUM({debitfxamount})) > 0 THEN (SUM({creditfxamount})-SUM({debitfxamount})) WHEN (SUM({debitfxamount}) IS null) THEN (SUM({creditfxamount}))ELSE 0 END",label:"Credit Foreign"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency",summary:"GROUP"},e)),search.createColumn(getSearchColumnForReports({name:"exchangerate",label:"Exchange Rate",summary:"GROUP"},e))]),o=e.useMultibookAccounting?"accountingtransaction":"transaction";debugPrintSavedSearchObject("AccountBalances",e,o,u,t);try{var s=search.create({type:o,settings:[],filters:u,columns:t}),l=s.runPaged({pageSize:1e3}).count;return{results:getSavedSearchPaginatedResults(s.run(),1e3,r,Math.min(e.offset+e.limit,l)),total_count:l}}catch(e){throw log.debug("error in getsearchResult",e),{type:"error.ReportsAPIError",name:"RUN_ERROR",message:e.message}}}function getPaginatedDataForGeneralLedgerReport(e){var t=e.report_type;if("general_ledger_report"!==t)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:`Pagination is not supported for ${t} report`};var t=e.fromDate,r=e.toDate,a=e.offset,o=e.accountingBook,n=e.subsidiary,u=e.forceAdd_subsidiary_field,s=e.accountingContext,l=e.useMultibookAccounting,c=[search.createColumn(getSearchColumnForReports({name:"internalid",join:"account",label:"Account Internal ID"},e)),search.createColumn(getSearchColumnForReports({name:"account",label:"Account"},e)),search.createColumn(getSearchColumnForReports({name:"type",label:"Transaction Type"},e)),search.createColumn(getSearchColumnForReports({name:"postingperiod",label:"Period"},e)),search.createColumn(getSearchColumnForReports({name:"trandate",label:"Date"},e)),search.createColumn(getSearchColumnForReports({name:"tranid",label:"Document Number"},e)),search.createColumn(getSearchColumnForReports({name:"entity",label:"Entity Name"},e)),search.createColumn(getSearchColumnForReports({name:"debitamount",label:"Debit Amount"},e)),search.createColumn(getSearchColumnForReports({name:"debitfxamount",label:"Debit Foreign Amount"},e)),search.createColumn(getSearchColumnForReports({name:"creditamount",label:"Credit Amount"},e)),search.createColumn(getSearchColumnForReports({name:"creditfxamount",label:"Credit Foreign Amount"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency"},e)),search.createColumn(getSearchColumnForReports({name:"exchangerate",label:"Exchange Rate"},e))],i=[["posting","is","T"],"AND",["formulatext: {account}","isnotempty",""],"AND",["formulanumeric: CASE WHEN ({creditamount} - {debitamount} = 0) THEN 0 WHEN ({debitamount} IS null) AND ({creditamount} IS null) THEN 0 ELSE 1 END","notequalto","0"]],t=(t&&r&&(i.push("AND"),i.push([getAttributeFullNameForReportFilter("trandate",e),"within",t,r])),n&&0<n.length?(i.push("AND"),i.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",n]),c.push(search.createColumn(getSearchColumnForReports({name:"subsidiary",label:"Subsidiary"},e)))):u&&c.push(search.createColumn(getSearchColumnForReports({name:"subsidiary",label:"Subsidiary"},e))),o&&(i.push("AND"),i.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",o]),c.push(search.createColumn(getSearchColumnForReports({name:"accountingbook",label:"Accounting Book"},e)))),s&&(i.push("AND"),i.push([getAttributeFullNameForReportFilter("account.accountingcontext",e),"anyof",s])),l?"accountingtransaction":"transaction");debugPrintSavedSearchObject("GeneralLedgerReport",e,t,i,c);try{var m=search.create({type:t,settings:[],filters:i,columns:c}),p=m.runPaged({pageSize:1e3}).count;return{results:getSavedSearchPaginatedResults(m.run(),1e3,a,Math.min(e.offset+e.limit,p)),total_count:p}}catch(e){throw log.debug("error in getsearchResult",e),{type:"error.ReportsAPIError",name:"RUN_ERROR",message:e.message}}}function getPaginatedDataForIncomeStatementReport(e){var t=e.report_type;if("income_statement"!==t)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:`Pagination is not supported for ${t} report`};var t=e.fromDate,r=e.toDate,a=e.offset,o=e.input_class,n=e.customer,u=e.department,s=e.item,l=e.location,c=e.accountingBook,i=e.subsidiary,m=e.timeperiods,p=e.forceAdd_department_field,g=e.forceAdd_location_field,d=e.forceAdd_class_field,h=e.forceAdd_item_field,S=e.forceAdd_subsidiary_field,f=[search.createColumn(getSearchColumnForReports({name:"accounttype",label:"Account Type"},e)),search.createColumn(getSearchColumnForReports({name:"account",label:"Account"},e)),search.createColumn(getSearchColumnForReports({name:"postingperiod",label:"Period"},e)),search.createColumn(getSearchColumnForReports({name:"trandate",label:"Date"},e)),search.createColumn(getSearchColumnForReports({name:"tranid",label:"Document Number"},e)),search.createColumn(getSearchColumnForReports({name:"amount",label:"Amount"},e)),search.createColumn(getSearchColumnForReports({name:"currency",label:"Currency"},e)),search.createColumn(getSearchColumnForReports({name:"fxamount",label:"Foreign Currency Amount"},e))],E=[[getAttributeFullNameForReportFilter("accounttype",e),"anyof","Income","COGS","Expense","OthIncome","OthExpense"],"AND",["posting","is","T"]],m=(m&&0<m.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("postingperiod",e),"anyof",m])):t&&r&&(E.push("AND"),E.push([getAttributeFullNameForReportFilter("trandate",e),"within",t,r])),o&&0<o.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("class",e),"anyof",o]),f.push(search.createColumn(getSearchColumnForReports({name:"class",label:"Class"},e)))):d&&f.push(search.createColumn(getSearchColumnForReports({name:"class",label:"Class"},e))),i&&0<i.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("subsidiary",e),"anyof",i]),f.push(search.createColumn(getSearchColumnForReports({name:"subsidiary",label:"Subsidiary"},e)))):S&&f.push(search.createColumn(getSearchColumnForReports({name:"subsidiary",label:"Subsidiary"},e))),c&&(E.push("AND"),E.push([getAttributeFullNameForReportFilter("accountingbook",e),"anyof",c]),f.push(search.createColumn(getSearchColumnForReports({name:"accountingbook",label:"Accounting Book"},e)))),n&&0<n.length&&(E.push("AND"),E.push([getAttributeFullNameForReportFilter("name",e),"anyof",n]),f.push(search.createColumn(getSearchColumnForReports({name:"entity",label:"Entity"},e)))),u&&0<u.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("department",e),"anyof",u]),f.push(search.createColumn(getSearchColumnForReports({name:"department",label:"Department"},e)))):p&&f.push(search.createColumn(getSearchColumnForReports({name:"department",label:"Department"},e))),s&&0<s.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("item",e),"anyof",s]),f.push(search.createColumn(getSearchColumnForReports({name:"item",label:"Item"},e)))):h&&f.push(search.createColumn(getSearchColumnForReports({name:"item",label:"Item"},e))),l&&0<l.length?(E.push("AND"),E.push([getAttributeFullNameForReportFilter("location",e),"anyof",l]),f.push(search.createColumn(getSearchColumnForReports({name:"location",label:"Location"},e)))):g&&f.push(search.createColumn(getSearchColumnForReports({name:"location",label:"Location"},e))),e.useMultibookAccounting?"accountingtransaction":"transaction");debugPrintSavedSearchObject("IncomeStatement",e,m,E,f);try{var b=search.create({type:m,settings:[],filters:E,columns:f}),N=b.runPaged({pageSize:1e3}).count;return{results:getSavedSearchPaginatedResults(b.run(),1e3,a,Math.min(e.offset+e.limit,N)),total_count:N}}catch(e){throw log.debug("error in getsearchResult",e),{type:"error.ReportsAPIError",name:"RUN_ERROR",message:e.message}}}function getReportColumns(e){return[]}function getUserFeaturesStatuses(e){var r={};return e.forEach(function(t){try{var e=runtime.isFeatureInEffect({feature:t});r[t]=e||"COEFFEMPTY"}catch(e){r[t]="Error: "+e.message}}),r}function getUserPreferencesAndPermissions(e,t){var r=runtime.getCurrentUser(),a={},o={};return e&&Array.isArray(e)&&e.forEach(function(t){try{a[t]=r.getPreference({name:t})||"COEFFEMPTY"}catch(e){a[t]="Error: "+e.message}}),t&&Array.isArray(t)&&t.forEach(function(t){try{o[t]=r.getPermission({name:t})}catch(e){o[t]="Error: "+e.message}}),{preferences:a,permissions:o}}function getSupportedReports(){return[{name:"trial_balance_report",label:"Trial Balance Report"},{name:"comparative_income_statement",label:"Comparative Income Statement Report"},{name:"income_statement",label:"Income Statement Report"},{name:"general_ledger_report",label:"General Ledger Report"}]}function validateRequestForReports(e){if(null==e.action||""===e.action)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:"action was not specified"};if(!["list","getColumnsMetadata","getPaged","getData"].includes(e.action))throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:"Invalid action specified"};if("list"!==e.action){if(null==e.report_type||""===e.report_type)throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:"report_type was not specified"};if(!["trial_balance_report","income_statement","general_ledger_report","account_balances"].includes(e.report_type))throw{type:"error.ReportsAPIError",name:"INVALID_REQUEST",message:"Invalid report_type specified"};if("getPaged"===e.action&&(null==e.offset||""===e.offset||null==e.limit))throw{type:"error.SavedSearchAPIError",name:"INVALID_REQUEST",message:"At least one offset or limit was not specified."}}}function postProcess(r){var e,t,a,o,n,u,s,l;if("version"===r.type)return{restletVersion:"1.6.7",userEmail:runtime.getCurrentUser().email,supportedOperations:["records","datasets","saved_searches","suiteql_query","reports","user_preferences_and_permissions","feature_status","custom_saved_search"]};if("user_preferences_and_permissions"===r.type)return getUserPreferencesAndPermissions(r.preferences,r.permissions);if("feature_status"===r.type)return getUserFeaturesStatuses(r.features);if("dataset"===r.type)try{if("getColumnsMetadata"===r.action){if(null==r.id||""===r.id)throw{type:"error.DatasetAPIError",name:"INVALID_REQUEST",message:"No ID was specified."};var c=dataset.load({id:r.id});return response.columns=c.columns,response.description=dataset.describe({id:r.id}),response}if("getPaged"===r.action){if(null==r.id||""===r.id||null==r.offset||""===r.offset||null==r.limit)throw{type:"error.DataSetAPIError",name:"INVALID_REQUEST",message:"At least one of id, offset or limit was not specified."};var i=dataset.load({id:r.id}),m=(log.debug({title:"Dataset "+r.id,details:i}),response.results=[],i.runPaged({pageSize:1e3}));return response.results=getDataFromPaginatedResults(m,1e3,r.offset,r.limit,"dataset"),response.totalResults=m.count,response}}catch(e){return log.debug({title:"error",details:e}),{error:{type:e.type,name:e.name,message:e.message}}}else if("reports"===r.type){validateRequestForReports(r);try{return"list"===r.action?(response.results=getSupportedReports(),response):"getColumnsMetadata"===r.action?(response.columns=getReportColumns(r.report_type),response):"getPaged"===r.action?("trial_balance_report"===r.report_type?({results:e,total_count:t}=getPaginatedDataForTrialBalanceReport(r),response.results=e,response.totalResults=t):"income_statement"===r.report_type?({results:a,total_count:o}=getPaginatedDataForIncomeStatementReport(r),response.results=a,response.totalResults=o):"general_ledger_report"===r.report_type?({results:n,total_count:u}=getPaginatedDataForGeneralLedgerReport(r),response.results=n,response.totalResults=u):"account_balances"===r.report_type&&({results:s,total_count:l}=getPaginatedAccountBalances(r),response.results=s,response.totalResults=l),response):void 0}catch(e){return log.debug({title:"error",details:e}),{error:{type:e.type,name:e.name,message:e.message}}}}else if("savedsearch"===r.type)try{if("list"===r.action){var p=search.create({type:search.Type.SAVED_SEARCH,columns:[search.createColumn({name:"id"}),search.createColumn({name:"title"}),search.createColumn({name:"recordtype"})]}),g=(response.results=[],p.run());let e=0;for(var d;d=g.getRange({start:e,end:e+1e3}),e+=1e3,response.results=response.results.concat(d),d.length;);return response.totalResults=response.results.length,response}if("getColumnsMetadata"===r.action){if(null==r.id||""===r.id)throw{type:"error.SavedSearchAPIError",name:"INVALID_REQUEST",message:"No ID was specified."};var h=search.load({id:r.id});return response.columns=h.columns,response}if("get"===r.action){if(null==r.id||""===r.id)throw{type:"error.SavedSearchAPIError",name:"INVALID_REQUEST",message:"No ID was specified."};var S=search.load({id:r.id}),f=(response.results=[],S.run());let e=0,t=[];var E=r.maxResults;do{if(t=f.getRange({start:e,end:e+1e3}),response.results=response.results.concat(t),e+=1e3,E&&e>E)break}while(t.length);return response}if("getPaged"===r.action){if(null==r.id||""===r.id||null==r.offset||""===r.offset||null==r.limit)throw{type:"error.SavedSearchAPIError",name:"INVALID_REQUEST",message:"At least one of id, offset or limit was not specified."};var b=search.load({id:r.id}),N=(log.debug({title:"Saved search "+r.id,details:b}),r.filters&&0<r.filters.length&&(b.filters=b.filters.concat(getSearchFilters(r.filters))),b.runPaged({pageSize:1e3}).count),R=b.run();return response.results=getSavedSearchPaginatedResults(R,1e3,r.offset,Math.min(r.offset+r.limit,N)),response.totalResults=N,response}}catch(e){return log.debug({title:"error",details:e}),{error:{type:e.type,name:e.name,message:e.message}}}else if("custom_saved_search"===r.type)try{if(null==r.object_type||null==r.filterArray||null==r.searchColumns)throw{type:"error.CustomSavedSearchAPIError",name:"INVALID_REQUEST",message:"object_type, filterArray, or searchColumns was not specified."};var A=r.searchColumns.map(e=>search.createColumn(e)),F=(debugPrintSavedSearchObject("Custom Saved Search",r,r.object_type,r.filterArray,A),search.create({type:r.object_type,settings:[],filters:r.filterArray,columns:A})),y=F.runPaged({pageSize:1e3}).count;if(r.get_total_count_only)return{results:[{totalResults:y}],totalResults:1};var C=F.run(),U=r.offset,M=r.limit;if(null==r.offset||""===r.offset||null==r.page_size||""===r.page_size)throw{type:"error.CustomSavedSearchAPIError",name:"INVALID_REQUEST",message:"offset or page_size was not specified."};return{results:getSavedSearchPaginatedResults(C,r.page_size,U,Math.min(U+M,y)),totalResults:y}}catch(e){return log.debug({title:"error",details:e}),{error:{type:e.type,name:e.name,message:e.message}}}else if("suiteql_query"===r.type)try{if(null==r.user_query||""===r.user_query||null==r.offset||""===r.offset)throw{type:"error.QueryAPIError",name:"INVALID_REQUEST",message:"No query or offset was specified."};var D="SELECT * FROM ( SELECT ROWNUM AS ROWNUMBER, * FROM ( "+r.user_query+" ) ) WHERE ( ROWNUMBER BETWEEN "+r.offset+" AND "+(r.offset+(r.page_size??5e3))+")",T="SELECT COUNT(*) as count FROM ("+r.user_query+")",I=query.runSuiteQL({query:D}).asMappedResults(),_=query.runSuiteQL({query:T}).asMappedResults();return response.results=I,response.totalResults=_[0].count,response}catch(e){return log.debug({title:"error",details:e}),{error:{type:e.type,name:e.name,message:e.message}}}}define(["N/log","N/search","N/dataset","N/workbook","N/record","N/runtime","N/query"],main);
